apply plugin: "com.android.application"
apply plugin: "kotlin-android"

def date = new GregorianCalendar()
def version = []
version.add(date.get(Calendar.YEAR) % 100)
version.add(date.get(Calendar.MONTH + 1))
version.add(date.get(Calendar.DAY_OF_MONTH))

android {
    compileSdkVersion 27
    defaultConfig {
        applicationId "com.ykrc17.game.qrzdconfigeditor"
        minSdkVersion 15
        targetSdkVersion 27
        versionName String.format("%2d%2d%2d", version.toArray())
        versionCode Integer.parseInt(versionName)
        resConfigs "xxhdpi", "ldltr", "appliance"
    }
    signingConfigs {
        release {//发布版本的签名配置
            storeFile file("keystore.jks")
            keyAlias "key0"
            storePassword "123456"
            keyPassword "123456"
        }
    }
    buildTypes {
        debug {
            signingConfig signingConfigs.release
        }
        release {
            debuggable false
            signingConfig signingConfigs.release
            minifyEnabled false
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
        }
    }
}

dependencies {
    def implLibs = [fileTree(include: ["*.jar"], dir: "libs"),
                    "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version",
                    "com.android.support:appcompat-v7:27.1.1",
                    "com.android.support:recyclerview-v7:27.1.1",
    ]
    implementation implLibs
}

tasks.whenTaskAdded {
    if (it.name == "assembleRelease") {
        it.doLast {
            copy {
                from("$buildDir/outputs/apk/release") {
                    include "*.apk"
                    rename("app-release", "qrzd-config-editor")
                }
                into rootProject.file("release")
            }
            copy {
                from("src/main/assets") {
                    include "*.json"
                }
                into rootProject.rootDir
            }
        }
    }
}